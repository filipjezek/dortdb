LET personList=(FOR post IN Post Filter post.creationDate>"2012-10" FOR person IN INBOUND post PersonHasPost COLLECT activist=person WITH COUNT INTO cnt SORT cnt DESC LIMIT 10 RETURN activist._key) FOR order IN Order FILTER order.PersonId IN personList COLLECT c=order.PersonId INTO g RETURN { Customer:c, Recency:MAX(g[*].order.OrderDate), Frequency:LENGTH(g[*]),Monetary:SUM(g[*].order.TotalPrice)}